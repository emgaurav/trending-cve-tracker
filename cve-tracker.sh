#!/bin/bash
rm top10.txt
echo " "|notify -silent
echo "*<<<<<<<<<<<<<<<<<----Top 10 CVEs in last 24 hrs---->>>>>>>>>>>>>>>>>>>>*"|notify -silent
echo " "|notify -silent
curl https://cvetrends.com/api/cves/24hrs|jq -c '.data[]|{CVE_ID: .cve, Description: .description, Audience_Size: .audience_size,Additional_Info: .tweets[0].tweet_text, URL: .tweets[0].urls[0].expanded_url, URL2: .tweets[1].urls[0].expanded_url}'>>top10.txt

while read -r i; do
	#cveid=jq -r .CVE_ID; 
	cveid=`echo $i|jq -r .CVE_ID`;
	desc=`echo $i|jq -r .Description`;
	additional=`echo $i|jq -r .Additional_Info`;
	aud=`echo $i|jq -r .Audience_Size`;
	link=`echo $i|jq -r .URL`;
	link2=`echo $i|jq -r .URL2`;
	curl -X POST -H 'Content-type: application/json' --data '{"blocks":[{"type":"header","text":{"type":"plain_text","text":"'$cveid'","emoji":true}},{"type":"section","fields":[{"type":"mrkdwn","text":"*Audience Size:*\n '$aud'"},{"type":"mrkdwn","text":"*Supportive Links:*\n '"$link"' \n '"$link2"'"}]},{"type":"section","text":{"type":"mrkdwn","text":"*Description:*\n '"$desc"'"}},{"type":"section","text":{"type":"mrkdwn","text":"*Additional Info:*\n '"$additional"'"}},{"type":"divider"}]}' https://hooks.slack.com/services/token

done<top10.txt
